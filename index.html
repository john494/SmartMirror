<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Smart Mirror">
    <meta name="author" content="Team: Pied Piper">
    <title>Smart Mirror Home</title>

    <!-- Custom CSS -->
    <link href="css/main.css" rel="stylesheet">
    <!-- Materialize CSS -->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <!-- Weather Widget CSS -->
    <link rel="stylesheet" href="widgets/weather/style.css" />
    <!-- Stock Widget CSS -->
    <link rel="stylesheet" href="widgets/stocks/style.css" />
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- To get rid of 'require jquery module' error -->
    <script>
        window.nodeRequire = require;
        delete window.require;
        delete window.exports;
        delete window.module;
    </script>
    <script window.$ = window.jQuery = require('js/jquery-2.1.1.min.js');></script>
    <script src="jquery.js"></script>

</head>

<body>
    <div class="container-fluid">

        <!-- Row 0 -->
        <div class="row">
            <div class="col s3 white-text" id="N1">
                <div id="clock" class="thin">
                    <div id="time"></div>
                    <!--<p id="time">9:25<span style="font-size:25px;">PM</span></p>-->
                    <p id="when"></p>
                </div>
            </div>
            <div class="col s9 white-text" id="N2">
                <div class="row" id="news">
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="CNN"></p>
                    </div>
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="WASH"></p>
                    </div>
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="ESPN"></p>
                    </div>
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="BLUM"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 1 -->
        <div class="row">
            <div class="col s3 white-text" id="L1">
                <div id="weather">
                    <section data-id="widget37" data-name="weather" data-size="variable" class="widget weather variable">
                    <div class="handle"></div>
                    <div class="content">
                        <div class="location" data-index="0">
                            <h6 class="header">Buffalo, NY</h6>
                            <div class="current thin">
                                <div id="currIcon"></div>
                                <div class="temp thin">
                                    <span id ="temp"></span>
                                    <sup>
                                        <span data-units="imperial" class="active" style="font-size:55%">°F</span>
                                    </sup>
                                </div>
                                <div class="details thin">
                                    <div class="status thin" id="description"></div>
                                    <div class="precip vertical-center center-vertical">
                                      <img  id="umbrella" src="widgets/weather/icons/umbrella.png" width="15px"/>
                                      <span id="precipitation"></span>
                                    </div>
                                </div>
                            </div>

                            <script>
                              var key = "85f6ad9b4d64ca03f1e00f6775de0259";

                              // Temporary values, make these dynamic later
                              var buff_lat = "42.998854";
                              var buff_lon = "-78.800475";

                              var current;

                              function weather() {
                                $.get("https://api.darksky.net/forecast/" + key + "/" + buff_lat + "," + buff_lon, function(data) {
                                  current = data['currently'];
                                  hourly = data['hourly'];
                                  var currIcon = current['icon'];
                                  currIcon = checkIcon(currIcon);
                                  document.getElementById('temp').innerHTML = Math.round(current['apparentTemperature']);
                                  document.getElementById('description').innerHTML = hourly['summary'];
                                  document.getElementById('precipitation').innerHTML = (current['precipProbability'] * 100) + "%";
                                  document.getElementById('currIcon').innerHTML = "<div class='cond " + currIcon + "'></div>";

                                  // Calculating hour based on location
                                  var icon1 = hourly['icon']; icon1 = checkIcon(icon1);
                                  var hour1 = (new Date(hourly['data'][1]['time'] * 1000)).getHours() - 12;
                                  hour1 = checkTime(hour1);

                                  var icon2 = hourly['icon']; icon2 = checkIcon(icon2);
                                  var hour2 = (new Date(hourly['data'][2]['time'] * 1000)).getHours() - 12;
                                  hour2 = checkTime(hour2);

                                  var icon3 = hourly['icon']; icon3 = checkIcon(icon3);
                                  var hour3 = (new Date(hourly['data'][3]['time'] * 1000)).getHours() - 12;
                                  hour3 = checkTime(hour3);

                                  var icon4 = hourly['icon']; icon4 = checkIcon(icon4);
                                  var hour4 = (new Date(hourly['data'][4]['time'] * 1000)).getHours() - 12;
                                  hour4 = checkTime(hour4);

                                  function checkTime(hour) {
                                    var newHour = 0;
                                    if (hour < 0){
                                      newHour = hour*-1;
                                      return newHour;
                                    }
                                    return hour;
                                  };

                                  // Getting AM or PM
                                  var d = new Date();
                                  var ampm = d.toString("tt");
                                  // Each hour
                                  document.getElementById('hour1').innerHTML = hour1 +" "+ ampm;
                                  document.getElementById('hour2').innerHTML = hour2 +" "+ ampm;
                                  document.getElementById('hour3').innerHTML = hour3 +" "+ ampm;
                                  document.getElementById('hour4').innerHTML = hour4 +" "+ ampm;

                                  // Temperature each hour
                                  document.getElementById('temp1').innerHTML = Math.round(hourly['data'][1]['apparentTemperature'])+"°";
                                  document.getElementById('temp2').innerHTML = Math.round(hourly['data'][2]['apparentTemperature'])+"°";
                                  document.getElementById('temp3').innerHTML = Math.round(hourly['data'][3]['apparentTemperature'])+"°";
                                  document.getElementById('temp4').innerHTML = Math.round(hourly['data'][4]['apparentTemperature'])+"°";

                                  // Icon each hour
                                  document.getElementById('icon1').innerHTML = "<div class='cond " + icon1 + "'></div>";
                                  document.getElementById('icon2').innerHTML = "<div class='cond " + icon2 + "'></div>";
                                  document.getElementById('icon3').innerHTML = "<div class='cond " + icon3 + "'></div>";
                                  document.getElementById('icon4').innerHTML = "<div class='cond " + icon4 + "'></div>";
                                });
                              }

                              // will translate the icon from DarkSky to what we have locally
                              // look at google keep to see available icons to be able to handle them all
                              // consider giphy for current
                              function checkIcon(darkskyname) {
                                var icon = "";
                                if(darkskyname == "cloudy"){ return darkskyname;}
                                if(darkskyname == "partly-cloudy-day"){return "partlycloudy";}
                                if(darkskyname == "clear-day"){return "sunny";}
                                if(darkskyname == "clear-night"){return darkskyname;}
                                if(darkskyname == "partly-cloudy-night"){return "partlycloudy-night";}
                                if(darkskyname == "rain"){return darkskyname;}
                                if(darkskyname == "wind"){return darkskyname;}
                                if(darkskyname == "fog"){return "cloudy";}
                                if(darkskyname == "thunderstorms"){return "tstorms";}
                                if(darkskyname == "snow"){return "lightsnow";}
                                if(darkskyname == "sleet"){return "lightrain-snow";}
                              }
                              weather(current);
                              // weather updates every 15 min or until reload of the page
                              setInterval(weather,90000);

                            </script>

                            <div class="forecast daily" tabindex="-1">
                                <div class="items">
                                    <div class="pull"></div>
                                    <div class="item" data-index="0" style="margin-left:6px;">
                                        <div class="period" id="hour1"></div>
                                        <div id="icon1"></div>
                                        <span class="high" id="temp1">°</span>
                                    </div>
                                    <div class="item" data-index="1">
                                        <div class="period" id="hour2"></div>
                                        <div id="icon2"></div>
                                        <span class="high" id="temp2">°</span>
                                    </div>
                                    <div class="item" data-index="2">
                                        <div class="period" id="hour3"></div>
                                        <div id="icon3"></div>
                                        <span class="high" id="temp3">°</span>
                                    </div>
                                    <div class="item" data-index="3">
                                        <div class="period" id="hour4"></div>
                                        <div id="icon4"></div>
                                        <span class="high" id="temp4">°</span>
                                    </div>
                                    <!-- if we want 5 things see line 328 in weather style CSS, 20% -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="resize"></div>
                </section>
                </div>
            </div>
            <div class="col s3 offset-s6" id="R1">
                <div id="calendar">
                    <h5 class="Vcenter white-text">Calendar</h5>
                    <div class="row">
                        <div class="col s12 white-text">
                            <table class="centered">
                            <thead>
                                <tr>
                                    <th data-field="cTime">Time</th>
                                    <th data-field="eventList">Event</th>
                                    <th data-field="cLocation">Place</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>12 AM</td>
                                    <td>CSE 489</td>
                                    <td>NSC 210</td>
                                </tr>
                                <tr>
                                    <td>1 PM</td>
                                    <td>CSE 410</td>
                                    <td>Norton 213</td>
                                </tr>
                                <tr>
                                    <td>2 PM</td>
                                    <td>CSE 442</td>
                                    <td>O'Brian 119</td>
                                </tr>
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="row">
            <div class="col s3 black-text" id="L2">
                <div id="stocks">
                    <div class="list">
                      <!-- Stock 1 -->
                      <div class="stock">
                				<div class="name">
                          <span id="stockname1"></span><br>
                					<span id="exchange1"></span>
                				</div>
                				<div class="price">
                					<span class="current" id="curprice1"></span>
                					<span class="change"  id="shift1"></span>
                				</div>
                			</div>
                      <!-- Stock 2 -->
                      <div class="stock">
                				<div class="name">
                          <span id="stockname2"></span><br>
                					<span id="exchange2"></span>
                				</div>
                				<div class="price">
                					<span class="current" id="curprice2"></span>
                					<span class="change"  id="shift2"></span>
                				</div>
                			</div>
                      <!-- Stock 3 -->
                      <div class="stock">
                				<div class="name">
                          <span id="stockname3"></span><br>
                					<span id="exchange3"></span>
                				</div>
                				<div class="price">
                					<span class="current" id="curprice3"></span>
                					<span class="change"  id="shift3"></span>
                				</div>
                			</div>
                      <!-- Stock 4 -->
                      <div class="stock">
                				<div class="name">
                          <span id="stockname4"></span><br>
                					<span id="exchange4"></span>
                				</div>
                				<div class="price">
                					<span class="current" id="curprice4"></span>
                					<span class="change"  id="shift4"></span>
                				</div>
                			</div>
                      <!-- <p class="grey-text text-lighten-1" style="padding-left:10px;">*Does not include After-hours</p> -->
                    </div>
                    <script>
                      getStock("AAPL", 1);
                      getStock("FB", 2);
                      getStock("NKE", 3);
                      getStock("TSLA", 4);

                      function getStock(symbol, i) {
                        $.get("http://finance.google.com/finance/info?client=iq&q=" + symbol, function(body) {
                          body = body.slice(4);
                          body = JSON.parse(body);

                          // Current share price
                          var companyname = body[0]['t'];
                          var exchange = body[0]['e'];
                          var price = body[0]['l'];
                          var pointchange = body[0]['c'];
                          var percentchange = body[0]['cp'];

                          document.getElementById('stockname'+i).innerHTML = companyname;
                          document.getElementById('exchange'+i).innerHTML = "("+exchange+")";
                          document.getElementById('curprice'+i).innerHTML  = price;

                          // choose appropriate color
                          if (pointchange < 0) {
                            document.getElementById('shift'+i).innerHTML = "<span style='color:red;'>▼ "+ pointchange + " (" + percentchange + "%)</span>";
                          } else {
                            document.getElementById('shift'+i).innerHTML = "<span style='color:green;'>▲ "+ pointchange + " (" + percentchange + "%)</span>";
                          };

                        });

                      }

                      setInterval(getStock("AAPL", 1),10000);
                      setInterval(getStock("FB", 2),  10000);
                      setInterval(getStock("NKE", 3), 10000);
                      setInterval(getStock("TSLA", 4),10000);

                    </script>

                </div>
            </div>
            <div class="col s3 offset-s6" id="R2">
                <div class="undefined">


                </div>
            </div>
        </div>

        <!-- Row 3 -->
        <div class="row">
            <div class="col s3 white-text" id="L3">
                <div class="undefined">

                </div>
            </div>
            <div class="col s3 offset-s6" id="R3">
                <div class="undefined">

                </div>
            </div>
        </div>
    </div>
</body>

    <!-- JS -->
    <script src="js/date.js"></script>
    <script><!-- Time -->
        function startClock() {
            var d = new Date()
            var c = d.toString("h:mm");
            var ampm = d.toString("tt");
            document.getElementById('time').innerHTML = c +" <span style='font-size:20px;'>"+ ampm + "</span>";
            var t = setTimeout(startClock, 500);
        };
        startClock();
    </script>
    <script><!-- Day, Month, Year -->
        var mydate = new Date()
        var year = mydate.getYear()
        if (year < 1000)
            year+=1900
        var day   = mydate.getDay()
        var month = mydate.getMonth()
        var daym  = mydate.getDate()
        if (daym < 10)
            daym = "0" + daym
        var dayarray = new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")
        var montharray = new Array("January","February","March","April","May","June","July","August","September","October","November","December")
        document.getElementById('when').innerHTML = "<p id='day'>"+dayarray[day]+"</p><p id='date'>"+montharray[month]+" "+daym+", "+year+"</p>";
    </script>
    <script src="js/materialize.min.js"></script>
    <!-- <script data-main="widgets/weather/view" src="http://requirejs.org/docs/release/2.3.2/comments/require.js"></script> -->

</html>
