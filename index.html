<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Smart Mirror">
    <meta name="author" content="Team: Pied Piper">
    <title>Smart Mirror Home</title>

    <!-- Custom CSS -->
    <link href="css/main.css" rel="stylesheet">
    <!-- Materialize CSS -->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <!-- Import Weather Icons -->
    <link rel="stylesheet" href="css/weather-icons.min.css" />
    <link rel="stylesheet" href="css/weather-icons-wind.min.css" />
    <!-- Weather Widget CSS -->
    <link rel="stylesheet" href="widgets/weather/style.css" />
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- To get rid of 'require jquery module' error -->
    <script>
        window.nodeRequire = require;
        delete window.require;
        delete window.exports;
        delete window.module;
    </script>
    <script window.$ = window.jQuery = require('js/jquery-2.1.1.min.js');></script>
    <script src="jquery.js"></script>

</head>

<body>
    <div class="container-fluid">

        <!-- Row 0 -->
        <div class="row">
            <div class="col s3 white-text" id="N1">
                <div id="clock" class="thin">
                    <div id="time"></div>
                    <!--<p id="time">9:25<span style="font-size:25px;">PM</span></p>-->
                    <p id="when"></p>
                </div>
            </div>
            <div class="col s9 white-text" id="N2">
                <div class="row" id="news">
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="CNN"></p>
                    </div>
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="USA"></p>
                    </div>
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="ESPN"></p>
                    </div>
                    <div class="col s3 Vcenter vertical-divider headline-padding">
                        <p id="BLUM"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- We should probably move this... -->
        <script>
          var apiKey = "7322bfbd152e4050b6054c1bd4601106"

          // Top CNN headline
          $.get("https://newsapi.org/v1/articles?source=cnn&sortBy=top&apiKey=" + apiKey, function(headlines) {
            document.getElementById('CNN').innerHTML = "CNN: " + headlines['articles'][0]['title']
          });

          // Top USA Today headline
          $.get("https://newsapi.org/v1/articles?source=usa-today&sortBy=top&apiKey=" + apiKey, function(headlines) {
            document.getElementById('USA').innerHTML = "USA Today: " + headlines['articles'][0]['title']
          });

          // Top ESPN headline
          $.get("https://newsapi.org/v1/articles?source=espn&sortBy=top&apiKey=" + apiKey, function(headlines) {
            document.getElementById('ESPN').innerHTML = "ESPN: " + headlines['articles'][0]['title']
          });

          // Top Blumberg headline
          $.get("https://newsapi.org/v1/articles?source=bloomberg&sortBy=top&apiKey=" + apiKey, function(headlines) {
            document.getElementById('BLUM').innerHTML = "Blumberg: " + headlines['articles'][0]['title']
          });
        </script>

        <!-- Row 1 -->
        <div class="row">
            <div class="col s3 white-text" id="L1">
                <div id="weather">
                    <section data-id="widget37" data-name="weather" data-size="variable" class="widget weather variable">
                    <div class="handle"></div>
                    <div class="content">
                        <div class="location" data-index="0">
                            <h6 class="header">Buffalo, NY</h6>
                            <div class="current">
                                <div id="currIcon"></div>
                                <span class="temp">
                                    <span id ="temp"></span>
                                    <sup class="">
                                        <span data-units="imperial" class="active" style="font-size:55%">°F</span>
                                    </sup>
                                </span>
                                <div class="details">
                                    <div class="status" id="description"></div>
                                    <div>Precip: <span id="precipitation"></span></div>
                                </div>
                            </div>

                            <script>
                              var key = "85f6ad9b4d64ca03f1e00f6775de0259";

                              // Temporary values, make these dynamic later
                              var buff_lat = "42.886447";
                              var buff_lon = "-78.878369";

                              var current;

                              function weather() {
                                $.get("https://api.darksky.net/forecast/" + key + "/" + buff_lat + "," + buff_lon, function(data) {
                                  current = data['currently'];
                                  hourly = data['hourly'];
                                  var currIcon = current['icon']; // make var for the hourly icons too
                                  currIcon = checkIcon(currIcon);
                                  document.getElementById('temp').innerHTML = Math.round(current['apparentTemperature']);
                                  document.getElementById('description').innerHTML = hourly['summary'];
                                  document.getElementById('precipitation').innerHTML = (current['precipProbability'] * 100) + "%";
                                  document.getElementById('currIcon').innerHTML = "<div class='cond " + currIcon + "'></div>";
                                  console.log(currIcon);

                                  // Calculating hour based on location
                                  var hour1 = (new Date(hourly['data'][1]['time'] * 1000)).getHours() - 12;
                                  var hour2 = (new Date(hourly['data'][2]['time'] * 1000)).getHours() - 12;
                                  var hour3 = (new Date(hourly['data'][3]['time'] * 1000)).getHours() - 12;
                                  var hour4 = (new Date(hourly['data'][4]['time'] * 1000)).getHours() - 12;
                                  var hour5 = (new Date(hourly['data'][5]['time'] * 1000)).getHours() - 12;


                                  // Getting AM or PM
                                  var d = new Date();
                                  var ampm = d.toString("tt");
                                  // Each hour
                                  document.getElementById('hour1').innerHTML = hour1 +" "+ ampm;
                                  document.getElementById('hour2').innerHTML = hour2 +" "+ ampm;
                                  document.getElementById('hour3').innerHTML = hour3 +" "+ ampm;
                                  document.getElementById('hour4').innerHTML = hour4 +" "+ ampm;
                                  document.getElementById('hour5').innerHTML = hour5 +" "+ ampm;
                                  // Temperature each hour
                                  document.getElementById('temp1').innerHTML = Math.round(hourly['data'][1]['apparentTemperature'])+"°";
                                  document.getElementById('temp2').innerHTML = Math.round(hourly['data'][2]['apparentTemperature'])+"°";
                                  document.getElementById('temp3').innerHTML = Math.round(hourly['data'][3]['apparentTemperature'])+"°";
                                  document.getElementById('temp4').innerHTML = Math.round(hourly['data'][4]['apparentTemperature'])+"°";
                                  document.getElementById('temp5').innerHTML = Math.round(hourly['data'][5]['apparentTemperature'])+"°";
                                });
                              }

                              // will translate the icon from DarkSky to what we have locally
                              // look at google keep to see available icons to be able to handle them all
                              // consider giphy for current
                              function checkIcon(darkskyname) {
                                var icon = "";
                                if(darkskyname == "partly-cloudy-day"){
                                  icon = "partlycloudy";
                                }
                                return icon;
                              }
                              weather(current);
                              // weather updates every 30 min or until reload of the page
                              setInterval(weather,1800000);

                            </script>

                            <div class="forecast daily" tabindex="-1">
                                <button type="button" class="material fab prev" data-direction="left" disabled=""></button>
                                <div class="items">
                                    <div class="pull"></div>
                                    <div class="item" data-index="0">
                                        <div class="period" id="hour1"></div>
                                        <div class="cond partlycloudy" title="Partly Sunny"></div>
                                        <span class="high" id="temp1">°</span>
                                    </div>
                                    <div class="item" data-index="1">
                                        <div class="period" id="hour2"></div>
                                        <div class="cond sunny" title="Sunny"></div>
                                        <span class="high" id="temp2">°</span>
                                    </div>
                                    <div class="item" data-index="2">
                                        <div class="period" id="hour3"></div>
                                        <div class="cond partlycloudy" title="Mostly Cloudy"></div>
                                        <span class="high" id="temp3">°</span>
                                    </div>
                                    <div class="item" data-index="3">
                                        <div class="period" id="hour4"></div>
                                        <div class="cond sunny" title="Sunny"></div>
                                        <span class="high" id="temp4">°</span>
                                    </div>
                                    <div class="item" data-index="4">
                                        <div class="period" id="hour5"></div>
                                        <div class="cond showers" title="Rain Showers"></div>
                                        <span class="high" id="temp5">°</span>
                                    </div>
                                </div>
                                <button type="button" class="material fab next" data-direction="right"></button>
                            </div>
                        </div>
                    </div>
                    <div class="resize"></div>
                </section>
                </div>
            </div>
            <div class="col s3 offset-s6" id="R1">
                <div id="calendar">
                    <h5 class="Vcenter white-text">Calendar</h5>
                    <div class="row">
                        <div class="col s12 white-text">
                            <table class="centered">
                            <thead>
                                <tr>
                                    <th data-field="cTime">Time</th>
                                    <th data-field="eventList">Event</th>
                                    <th data-field="cLocation">Place</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>12 AM</td>
                                    <td>CSE 489</td>
                                    <td>NSC 210</td>
                                </tr>
                                <tr>
                                    <td>1 PM</td>
                                    <td>CSE 410</td>
                                    <td>Norton 213</td>
                                </tr>
                                <tr>
                                    <td>2 PM</td>
                                    <td>CSE 442</td>
                                    <td>O'Brian 119</td>
                                </tr>
                                <tr>
                                    <td>3 PM</td>
                                    <td>CSE 468</td>
                                    <td>Baldy 114</td>
                                </tr>
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="row">
            <div class="col s3 black-text" id="L2">
                <div class="undefined">
                    <div id="stockname"></div>
                    <div id="curprice"></div>
                    <div id="shift"></div>

                    <script>
                      // using AAPL temporarily

                      getStock("AAPL");

                      function getStock(symbol) {
                        $.get("http://finance.google.com/finance/info?client=iq&q=" + symbol, function(body) {
                          body = body.slice(4);
                          body = JSON.parse(body);

                          // Current share price
                          var companyname = body[0]['t'];
                          var price = body[0]['l'];
                          var pointchange = body[0]['c'];
                          var percentchange = body[0]['cp'];

                          document.getElementById('stockname').innerHTML = companyname;
                          document.getElementById('curprice').innerHTML = price + " USD";

                          // choose appropriate color
                          if (pointchange < 0) {
                            document.getElementById('shift').innerHTML = "<span style='color:red;'>"+ pointchange + " (" + percentchange + "%)</span>";
                          } else {
                            document.getElementById('shift').innerHTML = "<span style='color:green;'>"+ pointchange + " (" + percentchange + "%)</span>";
                          };

                        });

                      }
                    </script>

                </div>
            </div>
            <div class="col s3 offset-s6" id="R2">
                <div class="undefined">

                </div>
            </div>
        </div>

        <!-- Row 3 -->
        <div class="row">
            <div class="col s3 white-text" id="L3">
                <div class="undefined">

                </div>
            </div>
            <div class="col s3 offset-s6" id="R3">
                <div class="undefined">

                </div>
            </div>
        </div>
    </div>
</body>

    <!-- JS -->
    <script src="js/date.js"></script>
    <script><!-- Time -->
        function startClock() {
            var d = new Date()
            var c = d.toString("h:mm tt");
            document.getElementById('time').innerHTML = c;
            var t = setTimeout(startClock, 500);
        };
        startClock();
    </script>
    <script><!-- Day, Month, Year -->
        var mydate = new Date()
        var year = mydate.getYear()
        if (year < 1000)
            year+=1900
        var day   = mydate.getDay()
        var month = mydate.getMonth()
        var daym  = mydate.getDate()
        if (daym < 10)
            daym = "0" + daym
        var dayarray = new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")
        var montharray = new Array("January","February","March","April","May","June","July","August","September","October","November","December")
        document.getElementById('when').innerHTML = "<p id='day'><b>"+dayarray[day]+"</b></p><p id='date'>"+montharray[month]+" "+daym+", "+year+"</p>";
    </script>
    <script src="js/materialize.min.js"></script>
    <!-- <script data-main="widgets/weather/view" src="http://requirejs.org/docs/release/2.3.2/comments/require.js"></script> -->

</html>
