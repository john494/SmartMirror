<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Smart Mirror">
    <meta name="author" content="Team: Pied Piper">
    <title>Smart Mirror Home</title>

    <!-- Custom CSS -->
    <link href="css/main.css" rel="stylesheet">
    <!-- Materialize CSS -->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <!-- Weather Widget CSS -->
    <link rel="stylesheet" href="widgets/weather/style.css" />
    <!-- Stock Widget CSS -->
    <link rel="stylesheet" href="widgets/stocks/style.css" />
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- To get rid of 'require jquery module' error -->
    <script>
        window.nodeRequire = require;
        delete window.require;
        delete window.exports;
        delete window.module;
    </script>
    <script window.$ = window.jQuery = require('js/jquery-2.1.1.min.js');></script>
    <script src="jquery.js"></script>

</head>

<body>
    <div class="container-fluid">
        <!-- Row 0 -->
        <div class="row">
            <div class="col s5 white-text" id="N1">
                <div id="clock">
                    <div class="thin" id="time"></div>
                </div>
                <div class="thin" id="clock" style="padding-left:15px;">
                    <p id="when"></p>
                </div>
            </div>
            <div class="col s7 white-text" id="N2">

            </div>
        </div>

        <!-- Row 1 -->
        <div class="row">
            <div class="col s3 white-text" id="L1">
                <div id="weather">
                  <div class="content">
                      <div class="location">
                          <h5 class="header" id="location"></h5>
                          <div class="current thin">
                              <div id="currIcon"></div>
                              <div class="temp thin">
                                  <span id ="temp"></span>
                                  <sup>
                                      <span data-units="imperial" class="active" style="font-size:55%">°F</span>
                                  </sup>
                              </div>
                              <div class="details thin">
                                  <div class="status thin" id="description"></div>
                                  <div class="precip vertical-center center-vertical">
                                    <img  id="umbrella" src="widgets/weather/icons/umbrella.png" width="15px"/>
                                    <span id="precipitation"></span>
                                  </div>
                              </div>
                          </div>
                          <div class="forecast daily" tabindex="-1">
                              <div class="items">
                                  <div class="pull"></div>
                                  <div class="item" style="margin-left:7px;">
                                      <div class="period" id="hour1"></div>
                                      <div id="icon1"></div>
                                      <span class="high" id="temp1">°</span>/ <span id="precip1"></span>
                                  </div>
                                  <div class="item">
                                      <div class="period" id="hour2"></div>
                                      <div id="icon2"></div>
                                      <span class="high" id="temp2">°</span>/ <span id="precip2"></span>
                                  </div>
                                  <div class="item">
                                      <div class="period" id="hour3"></div>
                                      <div id="icon3"></div>
                                      <span class="high" id="temp3">°</span>/ <span id="precip3"></span>
                                  </div>
                                  <div class="item">
                                      <div class="period" id="hour4"></div>
                                      <div id="icon4"></div>
                                      <span class="high" id="temp4">°</span>/ <span id="precip4"></span>
                                  </div>
                                  <!-- if we want 5 things see line 328 in weather style CSS, 20% -->
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="resize"></div>
                </div>
            </div>
            <div class="col s3 offset-s6" id="R1">
                <div id="calendar">
                    <h5 class="Vcenter white-text">Calendar</h5>
                    <div class="row">
                        <div class="col s12 white-text">
                            <table class="centered">
                            <thead>
                                <tr>
                                    <th data-field="cTime">Time</th>
                                    <th data-field="eventList">Event</th>
                                    <th data-field="cLocation">Place</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>12 AM</td>
                                    <td>CSE 489</td>
                                    <td>NSC 210</td>
                                </tr>
                                <tr>
                                    <td>1 PM</td>
                                    <td>CSE 410</td>
                                    <td>Norton 213</td>
                                </tr>
                                <tr>
                                    <td>2 PM</td>
                                    <td>CSE 442</td>
                                    <td>O'Brian 119</td>
                                </tr>
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="row">
            <div class="col s3 white-text" id="L2">
              <div id="news">
                <div class="row headline-padding">
                  <ul>
                    <li id="CNN"></li>
                    <li id="USA"></li>
                    <li id="ESPN"></li>
                    <li id="BLUM"></li>
                  </ul>
                  <style>#news ul {list-style-image: url('img/newspaper.png');margin-left: 28px;}</style>
                </div>
              </div>
            </div>
            <div class="col s3 offset-s6 white-text" id="R2">
              <div id="stocks">
                  <div class="list">
                    <!-- Stock 1 -->
                    <div class="stock border-top">
                      <div class="name">
                        <span id="stockname1"></span><br>
                        <span id="exchange1"></span>
                      </div>
                      <div class="price">
                        <span class="current" id="curprice1"></span>
                        <span class="change"  id="shift1"></span>
                      </div>
                    </div>
                    <!-- Stock 2 -->
                    <div class="stock">
                      <div class="name">
                        <span id="stockname2"></span><br>
                        <span id="exchange2"></span>
                      </div>
                      <div class="price">
                        <span class="current" id="curprice2"></span>
                        <span class="change"  id="shift2"></span>
                      </div>
                    </div>
                    <!-- Stock 3 -->
                    <div class="stock">
                      <div class="name">
                        <span id="stockname3"></span><br>
                        <span id="exchange3"></span>
                      </div>
                      <div class="price">
                        <span class="current" id="curprice3"></span>
                        <span class="change"  id="shift3"></span>
                      </div>
                    </div>
                    <!-- Stock 4 -->
                    <div class="stock">
                      <div class="name">
                        <span id="stockname4"></span><br>
                        <span id="exchange4"></span>
                      </div>
                      <div class="price">
                        <span class="current" id="curprice4"></span>
                        <span class="change"  id="shift4"></span>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
        </div>

        <!-- Row 3 -->
        <div class="row">
            <div class="col s3 white-text" id="L3">
                <div class="undefined">

                </div>
            </div>
            <div class="col s3 offset-s6" id="R3">
                <div class="undefined">

                </div>
            </div>
        </div>
    </div>
</body>

    <!-- JS -->
    <script src="js/date.js"></script>

    <!-- Clock JS -->
    <script>
        function startClock() {
            var d = new Date()
            var c = d.toString("h:mm");
            var ampm = d.toString("tt");
            document.getElementById('time').innerHTML = c +" <sup style='font-size:20px;top:0.0em'>"+ ampm + "</sup>";
            var t = setTimeout(startClock, 500);
        };
        startClock();
    </script>
    <!-- Day, Month, Year JS -->
    <script>
        var mydate = new Date()
        var year = mydate.getYear()
        if (year < 1000)
            year+=1900
        var day   = mydate.getDay()
        var month = mydate.getMonth()
        var daym  = mydate.getDate()
        if (daym < 10)
            daym = "0" + daym
        var dayarray = new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")
        var montharray = new Array("January","February","March","April","May","June","July","August","September","October","November","December")
        document.getElementById('when').innerHTML = "<p id='day'>"+dayarray[day]+"</p><p id='date'>"+montharray[month]+" "+daym+", "+year+"</p>";
    </script>
    <!-- Location JS -->
    <script>
      // Temporary values, make these dynamic later
      var buff_lat = "42.998854";
      var buff_lon = "-78.800475";

      function getLocation() {
        $.get("http://maps.googleapis.com/maps/api/geocode/json?latlng="+ buff_lat + "," + buff_lon + "&sensor=true", function(body) {
          // KEY for 'address_components'
          // [1] Street name, [2] City Name, [3] Town, [4] County, [5] State, [6] Country, [7] Zip Code
          var town = body['results'][0]['address_components'][3]['long_name'];
          var state = body['results'][0]['address_components'][5]['short_name']; // long_name is full name
          document.getElementById('location').innerHTML = town +", " + state;
        });
      }
      getLocation();
    </script>
    <!-- News Headlines JS -->
    <script>
      var apiKey = "7322bfbd152e4050b6054c1bd4601106"

      // Top CNN headline
      $.get("https://newsapi.org/v1/articles?source=cnn&sortBy=top&apiKey=" + apiKey, function(headlines) {
        document.getElementById('CNN').innerHTML = "CNN: " + headlines['articles'][0]['title']
      });

      // Top USA Today headline
      $.get("https://newsapi.org/v1/articles?source=usa-today&sortBy=top&apiKey=" + apiKey, function(headlines) {
        document.getElementById('USA').innerHTML = "USA Today: " + headlines['articles'][0]['title']
      });

      // Top ESPN headline
      $.get("https://newsapi.org/v1/articles?source=espn&sortBy=top&apiKey=" + apiKey, function(headlines) {
        document.getElementById('ESPN').innerHTML = "ESPN: " + headlines['articles'][0]['title']
      });

      // Top Blumberg headline
      $.get("https://newsapi.org/v1/articles?source=bloomberg&sortBy=top&apiKey=" + apiKey, function(headlines) {
        document.getElementById('BLUM').innerHTML = "Blumberg: " + headlines['articles'][0]['title']
      });
    </script><
    <!-- Stock Widget JS -->
    <script>
      getStock("AAPL", 1);
      getStock("FB", 2);
      getStock("NKE", 3);
      getStock("TSLA", 4);

      function getStock(symbol, i) {
        $.get("http://finance.google.com/finance/info?client=iq&q=" + symbol, function(body) {
          body = body.slice(4);
          body = JSON.parse(body);

          // Current share price
          var companyname = body[0]['t'];
          var exchange = body[0]['e'];
          var price = body[0]['l'];
          var pointchange = body[0]['c'];
          var percentchange = body[0]['cp'];

          document.getElementById('stockname'+i).innerHTML = companyname;
          document.getElementById('exchange'+i).innerHTML = "("+exchange+")";
          document.getElementById('curprice'+i).innerHTML  = price;

          // choose appropriate color
          if (pointchange < 0) {
            document.getElementById('shift'+i).innerHTML = "<span style='color:red;'>▼ "+ pointchange + " (" + percentchange + "%)</span>";
          } else {
            document.getElementById('shift'+i).innerHTML = "<span style='color:green;'>▲ "+ pointchange + " (" + percentchange + "%)</span>";
          };

        });

      }

      setInterval(getStock("AAPL", 1),10000);
      setInterval(getStock("FB", 2),  10000);
      setInterval(getStock("NKE", 3), 10000);
      setInterval(getStock("TSLA", 4),10000);

    </script><!-- Stock Widget Script -->
    <!-- Weather Widget JS -->
    <script>
      var key = "85f6ad9b4d64ca03f1e00f6775de0259";
      // Temporary values, make these dynamic later
      var buff_lat = "42.998854";
      var buff_lon = "-78.800475";
      var current;

      function weather() {
        $.get("https://api.darksky.net/forecast/" + key + "/" + buff_lat + "," + buff_lon, function(data) {
          current = data['currently'];
          hourly = data['hourly'];
          var currIcon = current['icon'];
          currIcon = checkIcon(currIcon);

          document.getElementById('temp').innerHTML          = Math.round(current['apparentTemperature']);
          document.getElementById('description').innerHTML   = (hourly['summary']).slice(0,-1);
          document.getElementById('precipitation').innerHTML = (current['precipProbability'] * 100) + "%";
          document.getElementById('currIcon').innerHTML      = "<div class='cond " + currIcon + "'></div>";

          // Getting AM or PM
          var d = new Date();
          var ampm = d.toString("tt");

          // Icon per hour
          for(i = 1; i <= 4; i ++){
            var icon = hourly['data'][i]['icon'];
            icon = checkIcon(icon);
            document.getElementById('icon'+i).innerHTML = "<div class='cond " + icon + "'></div>";
          }

          // Each actual hour
          for(i = 1; i <= 4; i++){
            var hour = (new Date(hourly['data'][i]['time'] * 1000)).getHours();
            if (hour > 12) {
              hour = hour - 12;
              ampm = 'PM';
            } else if (hour == 12) {
              ampm = 'PM';
            } else if (hour == 0) {
              hour = 12;
              ampm = 'AM';
            }
            document.getElementById('hour'+i).innerHTML = hour +" "+ ampm;
          }

          // Temperature/Precip each hour
          for(i = 1; i <= 4; i ++){
            document.getElementById('temp'+i).innerHTML   = Math.round(hourly['data'][i]['apparentTemperature'])+"°";
            document.getElementById('precip'+i).innerHTML = Math.round(hourly['data'][i]['precipProbability'] * 100) + "%";
          }

        });
      }

      // will translate the icon from DarkSky to what we have locally
      // consider giphy for current
      function checkIcon(darkskyname) {
        var d = new Date();
        var hour = d.toString("h");
        var nightHour = 6;
        if(darkskyname == "cloudy"){ if(nightHour <= hour){ return "cloudy-night";} return darkskyname;}
        if(darkskyname == "partly-cloudy-day"){  return "partlycloudy";}
        if(darkskyname == "partly-cloudy-night"){return "partlycloudy-night";}
        if(darkskyname == "clear-day"){          return darkskyname;}
        if(darkskyname == "clear-night"){        return darkskyname;}
        if(darkskyname == "rain"){               if(nightHour <= hour){ return "rainy-night";}   return darkskyname;}
        if(darkskyname == "wind"){               if(nightHour <= hour){ return "windy-night";}   return darkskyname;}
        if(darkskyname == "fog") {               if(nightHour <= hour){ return "foggy-night";}   return darkskyname;}
        if(darkskyname == "thunderstorms"){      if(nightHour <= hour){ return "thunder-night";} return darkskyname;}
        if(darkskyname == "snow"){               if(nightHour <= hour){ return "snow-night";}    return darkskyname;}
        if(darkskyname == "sleet"){              if(nightHour <= hour){ return "sleet-night";}   return darkskyname;}
      }
      weather(current);
      // weather updates every 15 min or until reload of the page
      setInterval(weather,90000);
    </script>
    <script src="js/materialize.min.js"></script>
    <!-- <script data-main="widgets/weather/view" src="http://requirejs.org/docs/release/2.3.2/comments/require.js"></script> -->

</html>
